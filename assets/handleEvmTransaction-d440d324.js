import{dY as S,bO as V,bM as $,bN as L,a_ as O,b6 as i,bx as R,bR as U,bp as m,dZ as _,d_ as b,bP as x,c4 as K,c5 as k,bJ as Y,bK as J,c6 as M,d$ as H,c_ as Z}from"./index-2aebba82.js";import{a as j,b as q,c as z,d as D,e as Q}from"./CryptoWalletConnectionHandler-dbba8378.js";import"./index-480d4515.js";import"./clsx.m-63a8bdbc.js";import"./isAddressEqual-377be7f7.js";import"./index-3b961d20.js";function A(t,e="hex"){const n=(()=>{if(typeof t=="string"){if(t.length>3&&t.length%2!==0)throw new S(t);return V(t)}return t})(),r=$(n,{recursiveReadLimit:Number.POSITIVE_INFINITY});return G(r,e)}function G(t,e="hex"){if(t.bytes.length===0)return e==="hex"?L(t.bytes):t.bytes;const n=t.readByte();if(n<128&&t.decrementPosition(1),n<192){const s=F(t,n,128),o=t.readBytes(s);return e==="hex"?L(o):o}const r=F(t,n,192);return X(t,r,e)}function F(t,e,n){if(n===128&&e<128)return 1;if(e<=n+55)return e-n;if(e===n+55+1)return t.readUint8();if(e===n+55+2)return t.readUint16();if(e===n+55+3)return t.readUint24();if(e===n+55+4)return t.readUint32();throw new O("Invalid RLP prefix")}function X(t,e,n){const r=t.position,s=[];for(;t.position-r<e;)s.push(G(t,n));return s}function ee(t){return i(t)&&R(t)===32}function te(t){const e=U(t,0,1);if(e==="0x03")return"eip4844";if(e==="0x02")return"eip1559";if(e==="0x01")return"eip2930";if(e!=="0x"&&m(e)>=192)return"legacy";throw new _({serializedType:e})}function ne(t){const e=te(t);return e==="eip1559"?ae(t):e==="eip2930"?se(t):e==="eip4844"?re(t):ie(t)}function re(t){const e=I(t),n=e.length===4,r=n?e[0]:e,s=n?e.slice(1):[],[o,l,d,u,a,g,c,p,f,h,v,W,N,B]=r,[T,C,E]=s;if(!(r.length===11||r.length===14))throw new b({attributes:{chainId:o,nonce:l,maxPriorityFeePerGas:d,maxFeePerGas:u,gas:a,to:g,value:c,data:p,accessList:f,...r.length>9?{v:W,r:N,s:B}:{}},serializedTransaction:t,type:"eip4844"});const y={blobVersionedHashes:v,chainId:m(o),type:"eip4844"};return i(g)&&g!=="0x"&&(y.to=g),i(a)&&a!=="0x"&&(y.gas=x(a)),i(p)&&p!=="0x"&&(y.data=p),i(l)&&l!=="0x"&&(y.nonce=m(l)),i(c)&&c!=="0x"&&(y.value=x(c)),i(h)&&h!=="0x"&&(y.maxFeePerBlobGas=x(h)),i(u)&&u!=="0x"&&(y.maxFeePerGas=x(u)),i(d)&&d!=="0x"&&(y.maxPriorityFeePerGas=x(d)),f.length!==0&&f!=="0x"&&(y.accessList=P(f)),T&&C&&E&&(y.sidecars=K({blobs:T,commitments:C,proofs:E})),j(y),{...r.length===14?w(r):void 0,...y}}function ae(t){const e=I(t),[n,r,s,o,l,d,u,a,g,c,p,f]=e;if(!(e.length===9||e.length===12))throw new b({attributes:{chainId:n,nonce:r,maxPriorityFeePerGas:s,maxFeePerGas:o,gas:l,to:d,value:u,data:a,accessList:g,...e.length>9?{v:c,r:p,s:f}:{}},serializedTransaction:t,type:"eip1559"});const h={chainId:m(n),type:"eip1559"};return i(d)&&d!=="0x"&&(h.to=d),i(l)&&l!=="0x"&&(h.gas=x(l)),i(a)&&a!=="0x"&&(h.data=a),i(r)&&r!=="0x"&&(h.nonce=m(r)),i(u)&&u!=="0x"&&(h.value=x(u)),i(o)&&o!=="0x"&&(h.maxFeePerGas=x(o)),i(s)&&s!=="0x"&&(h.maxPriorityFeePerGas=x(s)),g.length!==0&&g!=="0x"&&(h.accessList=P(g)),q(h),{...e.length===12?w(e):void 0,...h}}function se(t){const e=I(t),[n,r,s,o,l,d,u,a,g,c,p]=e;if(!(e.length===8||e.length===11))throw new b({attributes:{chainId:n,nonce:r,gasPrice:s,gas:o,to:l,value:d,data:u,accessList:a,...e.length>8?{v:g,r:c,s:p}:{}},serializedTransaction:t,type:"eip2930"});const f={chainId:m(n),type:"eip2930"};return i(l)&&l!=="0x"&&(f.to=l),i(o)&&o!=="0x"&&(f.gas=x(o)),i(u)&&u!=="0x"&&(f.data=u),i(r)&&r!=="0x"&&(f.nonce=m(r)),i(d)&&d!=="0x"&&(f.value=x(d)),i(s)&&s!=="0x"&&(f.gasPrice=x(s)),a.length!==0&&a!=="0x"&&(f.accessList=P(a)),z(f),{...e.length===11?w(e):void 0,...f}}function ie(t){const e=A(t,"hex"),[n,r,s,o,l,d,u,a,g]=e;if(!(e.length===6||e.length===9))throw new b({attributes:{nonce:n,gasPrice:r,gas:s,to:o,value:l,data:d,...e.length>6?{v:u,r:a,s:g}:{}},serializedTransaction:t,type:"legacy"});const c={type:"legacy"};if(i(o)&&o!=="0x"&&(c.to=o),i(s)&&s!=="0x"&&(c.gas=x(s)),i(d)&&d!=="0x"&&(c.data=d),i(n)&&n!=="0x"&&(c.nonce=m(n)),i(l)&&l!=="0x"&&(c.value=x(l)),i(r)&&r!=="0x"&&(c.gasPrice=x(r)),D(c),e.length===6)return c;const p=i(u)&&u!=="0x"?x(u):0n;if(g==="0x"&&a==="0x")return p>0&&(c.chainId=Number(p)),c;const f=p,h=Number((f-35n)/2n);if(h>0)c.chainId=h;else if(f!==27n&&f!==28n)throw new k({v:f});return c.v=f,c.s=g,c.r=a,c.yParity=f%2n===0n?1:0,c}function I(t){return A(`0x${t.slice(4)}`,"hex")}function P(t){const e=[];for(let n=0;n<t.length;n++){const[r,s]=t[n];if(!Y(r,{strict:!1}))throw new J({address:r});e.push({address:r,storageKeys:s.map(o=>ee(o)?o:M(o))})}return e}function w(t){const e=t.slice(-3),n=e[0]==="0x"||x(e[0])===0n?27n:28n;return{r:H(e[1],{size:32}),s:H(e[2],{size:32}),v:n,yParity:n===27n?0:1}}function xe(t){return Z(this,arguments,function*({primaryWallet:e,chain:n,serializedTransaction:r,iframeClient:s}){let{connector:o}=e,l=Q(n);try{yield o.switchNetwork({networkChainId:l})}catch(a){console.error(`[CryptoWalletConnectionHandler] failed to switch network to ${l}`,a),s.send("crypto:send-transaction:failed",{error:a.message});return}let d;try{if(d=o.getWalletClient(String(l)),!d)throw new Error(`connector.getWalletClient(${l}) returned undefined`)}catch(a){console.error("[CryptoWalletConnectionHandler] failed to get wallet client",a),s.send("crypto:send-transaction:failed",{error:a.message});return}let u;try{u=ne(r)}catch(a){console.error("[CryptoWalletConnectionHandler] failed to parse transaction",a),s.send("crypto:send-transaction:failed",{error:a.message});return}try{let a=yield d.sendTransaction(u);console.log("[CryptoWalletConnectionHandler] txId",a),s.send("crypto:send-transaction:success",{txId:a})}catch(a){console.error("[CryptoWalletConnectionHandler] failed to send transaction",a),s.send("crypto:send-transaction:failed",{error:a.message})}})}export{xe as handleEvmTransaction};
